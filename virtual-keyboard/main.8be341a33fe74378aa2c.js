(()=>{"use strict";function e(){document.querySelector(".capslock-indicator").classList.toggle("active")}function t(e,t){const a=document.querySelector(".text-area"),n=a.value.slice(t,a.value.length);a.value=a.value.slice(0,t)+e.innerText[0]+n}function a(e){const t=document.querySelector(".text-area");t.value=t.value.slice(0,e)+"    "+t.value.slice(e,t.value.length)}function n(){return document.querySelector(".text-area").selectionStart}const o=document.body,c=document.head;let l=localStorage.getItem("lang")||"en",s=0;const r=document.createElement("link");r.src="../public/favicon.ico",r.rel="shortcut icon",r.type="image/x-icon",c.append(r);const u=document.createElement("main");u.classList.add("keyboard-page"),o.append(u);const d=document.createElement("div");d.classList.add("keyboard-container"),u.append(d);const i=document.createElement("textarea");i.classList.add("text-area"),i.setAttribute("autofocus",!0),d.append(i),i.addEventListener("mouseout",(()=>{s=n()})),i.addEventListener("blur",(()=>{i.focus(),i.selectionEnd=s}));const v=document.createElement("div");v.classList.add("keyboard"),d.append(v);const y=document.createElement("p");async function m(){v.innerHTML="";const e=await fetch("./keys.json"),t=await e.json();let a=0;"ru"===l&&(a=1),t[a].keys.forEach((e=>function(e){const t=document.querySelector(".keyboard"),a=document.createElement("div");if(a.classList.add("key"),a.innerHTML=`${e.value}`,e.alt){const t=document.createElement("span");t.classList.add("key-alt"),t.innerHTML=`${e.alt}`,a.append(t),a.setAttribute("data-altvalue",`${e.alt}`)}"Win"===e.value?a.setAttribute("data-value","meta"):"↑"===e.value?a.setAttribute("data-value","arrowup"):"↓"===e.value?a.setAttribute("data-value","arrowdown"):"→"===e.value?a.setAttribute("data-value","arrowright"):"←"===e.value?a.setAttribute("data-value","arrowleft"):a.setAttribute("data-value",`${e.value.toLowerCase()}`),a.classList.add(`${e.size}`),t.append(a)}(e)));const n=document.querySelector(".key[data-value = capslock]"),o=document.createElement("div");o.classList.add("capslock-indicator"),n.append(o)}y.classList.add("notes"),y.innerHTML="Клавиатура выполнена на Windows, язык переключается сочетанием клавиш Alt+Shift",u.prepend(y),m(),window.addEventListener("keydown",(e=>{document.querySelectorAll(`div[data-value = '${e.key.toLowerCase()}']`).forEach((e=>e.classList.add("active"))),s+=1})),window.addEventListener("keyup",(e=>{document.querySelectorAll(`div[data-value = '${e.key.toLowerCase()}']`).forEach((e=>e.classList.remove("active")))})),v.addEventListener("mousedown",(e=>{const t=document.querySelector(".capslock-indicator").classList.contains("active");let a=!1;e.shiftKey&&(a=!0),function(e,t,a,n){if(!e)throw new Error("ooops, you missclicked the key");const o=document.querySelector(".text-area");if(e.dataset.value.length<2&&" "!==e.dataset.value){let c=e.innerText[0].toLowerCase();e.dataset.altvalue&&t&&(c=e.lastChild.innerText),(t||a)&&(c=c.toUpperCase()),o.value=o.value.slice(0,n)+c+o.value.slice(n,o.value.length)}}(e.target.closest(".key"),a,t,s),s+=1})),v.addEventListener("mousedown",(t=>{t.target.closest(".key")===document.querySelector(".key[data-value = capslock]")&&e()})),window.addEventListener("keydown",(t=>{"CapsLock"===t.key&&(t.preventDefault(),e(),s-=1)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")===document.querySelector(".spacebar")&&(s-=1,function(e){const t=document.querySelector(".text-area");t.value=t.value.slice(0,e)+" "+t.value.slice(e,t.value.length)}(s),s+=1)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")!==document.querySelector(".key[data-value = arrowup]")&&e.target.closest(".key")!==document.querySelector(".key[data-value = arrowdown]")&&e.target.closest(".key")!==document.querySelector(".key[data-value = arrowleft]")&&e.target.closest(".key")!==document.querySelector(".key[data-value = arrowright]")||(s-=1,t(e.target,s),s+=1)})),window.addEventListener("keydown",(e=>{if(e.key.includes("Arrow")){e.preventDefault();const a=document.querySelector(`.key[data-value = ${e.key.toLocaleLowerCase()}]`);s-=1,t(a,s),s+=1}})),window.addEventListener("keydown",(e=>{"Tab"===e.key&&(e.preventDefault(),e.stopPropagation(),s-=1,a(s),s+=4)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")===document.querySelector(".key[data-value = tab]")&&(s-=1,a(s),s+=4)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")===document.querySelector(".key[data-value = enter]")&&(s-=1,function(e){const t=document.querySelector(".text-area");t.value=t.value.slice(0,e)+"\n"+t.value.slice(e,t.value.length)}(s),s+=1)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")===document.querySelector(".key[data-value = backspace]")&&(function(){const e=document.querySelector(".text-area");e.value=e.value.slice(0,n()-1)+e.value.slice(n(),e.value.length)}(),s-=2)})),v.addEventListener("mousedown",(e=>{e.target.closest(".key")===document.querySelector(".key[data-value = delete]")&&(s-=1,function(e){const t=document.querySelector(".text-area");t.value=t.value.slice(0,e)+t.value.slice(e+1,t.value.length)}(s))})),window.addEventListener("keydown",(e=>{if("Alt"===e.key){e.preventDefault();const t=document.querySelector(".key[data-value = alt]"),a=document.querySelector(".key[data-value = shift]");t.classList.contains("active")&&a.classList.contains("active")&&("en"===l?(l="ru",m(),window.localStorage.setItem("lang",l)):(l="en",m(),window.localStorage.setItem("lang",l)))}}))})();